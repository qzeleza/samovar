<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Тестирование анимации</title>
  <link
          rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css"
  />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div class="container mt-5">
  <h1 class="text-center mb-4">Тестирование анимации</h1>
  <div class="d-flex justify-content-center mb-4">
    <img
            src="../../assets/images/logo/logo_image_gold.svg"
            alt="Изображение"
            id="image"
            class="img-fluid"
            style="max-height: 30vh"
    />
  </div>
  <div class="d-flex justify-content-center">
    <button class="btn btn-primary" id="start">Запустить анимацию</button>
  </div>
</div>

<script>
  class ModalAnimation {
    /**
     * Создает новый экземпляр класса ModalAnimation.
     * @param {string} imgSrc - Источник изображения.
     * @param {number} imgSize - Размер изображения.
     * @param {number} overlayOpacity - Непрозрачность затемнения.
     * @param {number} cycleDuration - Продолжительность цикла анимации.
     * @param {number} rotationSpeed - Скорость вращения.
     * @param {number} acceleration - ускорение вращения.
     */
    constructor(imgSrc, imgSize, overlayOpacity, cycleDuration, rotationSpeed, acceleration) {
      this.imgSize = imgSize;
      this.cycleDuration = cycleDuration / 1000;
      this.overlayOpacity = overlayOpacity;
      this.imgSrc = imgSrc;
      this.rotationSpeed = rotationSpeed;
      this.interval = null;
      this.$imgContainer = null;
      this.$overlay = null;
      this.acceleration = acceleration;
    }

    /**
     * Запускает анимацию вращения изображения.
     */
    start() {
      try {
        // Создание элементов
        this.$overlay = $('<div>').css({
          position: 'fixed',
          top: 0,
          left: 0,
          width: '100%',
          height: '100%',
          backgroundColor: 'black',
          opacity: this.overlayOpacity / 100,
          zIndex: 9998
        });
        this.$imgContainer = $('<div>').css({
          borderRadius: '50%',
          border: `${this.imgSize * 0.04}vh solid white`,
          overflow: 'hidden',
          position: 'fixed',
          top: '40%',		// ориентация по высоте отображения анимации
          left: '50%',  	// ориентация по ширине отображения анимации
          transform: 'translate(-50%, -50%)',
          width: `${this.imgSize}vh`,
          height: `${this.imgSize}vh`,
          zIndex: 9999,

        });
        const $img = $('<img>')
                .attr('src', this.imgSrc)
                .css({
                  position: 'absolute',
                  top: '-2%',
                  left: 0,
                  width: '100%',
                  height: '100%',
                  padding: '20%'
                }).on('error', () => {
                  // Обработка ошибки загрузки изображения
                  console.error(`Ошибка загрузки изображения ${this.imgSrc}`);
                  this.stop();
                });
        this.$imgContainer.append($img);
        $('body').append(this.$overlay).append(this.$imgContainer);

        // Анимация
        let angle = 0;
        let speed = 0;

        // Функция для обновления анимации
        const updateAnimation = (rotationType) => {
          if (rotationType === 'clockwise') {
            angle += speed;
            if (angle >= 1) angle -= 1;
          } else if (rotationType === 'counterclockwise') {
            angle -= speed;
            if (angle <= -1) angle += 1;
          }
          if (speed < this.rotationSpeed) speed += this.acceleration;
          this.$imgContainer.css('transform', `translate(-50%, -50%)
          		rotateY(${angle}deg)
          		rotateX(${angle}deg)
          		rotateY(${angle}deg)
          		rotateX(${angle}deg)
          		`);
        };

        // Запуск первого цикла анимации
        this.interval = setInterval(() => updateAnimation('counterclockwise'), this.cycleDuration);


      }
      catch(error) {
        console.error(`Ошибка при запуске анимации: ${error.message}`);
        this.stop();
      }
    }
    /**
     * Останавливает анимацию вращения изображения.
     */
    stop() {
      clearInterval(this.interval);
      this.$imgContainer.remove();
      this.$overlay.remove();
    }

  }
  // Использование
  let animation;
  $('#start').on('click', () => {
    const imgSrc = $('#image').attr('src');
    // imgSrc, imgSize, overlayOpacity, cycleDuration, rotationSpeed
    animation = new ModalAnimation(imgSrc, 15, 70, 1, 1, 3);
    animation.start();
  });
</script>
</body>
</html>
