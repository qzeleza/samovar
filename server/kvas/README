Необходимо на чистой системе (Debian 10) выполнить следующий код
---------------------
APP_NAME=kvas
API_PATH=/apps/${APP_NAME}
API_PORT_OUTSIDE=11133
API_PORT_INSIDE=33666

apt update && apt upgrade
apt-get install -y build-essential python3-venv ufw libffi-dev libpcre3-dev python3-dev curl nano nginx net-tools certbot logrotate rsync

mkdir -p "${API_PATH}"
python3 -m venv venv
. "${API_PATH}/venv/bin/active"

pip install --upgrade pip setuptools
pip install wheel flask[async] python-telegram-bot gunicorn cryptography certifi flask-socketio gevent Flask-Caching gevent-websocket
pip install -U flask-cors

mkdir /etc/systemd/system/nginx.service.d
printf "[Service]\nExecStartPost=/bin/sleep 1\n" > /etc/systemd/system/nginx.service.d/override.conf

ufw allow "${API_PORT_OUTSIDE}/tcp"
ufw enable

rm /etc/nginx/sites-enabled/default
cp ${API_PATH}/gunicorn.service /etc/systemd/system/${APP_NAME}.service
ln -s ${API_PATH}/nginx.conf /etc/nginx/sites-enabled/${APP_NAME}
ln -s ${API_PATH}/${APP_NAME}.logrotate /etc/logrotate.d/${APP_NAME}

# Возможно уже имеются
# groupadd root
# useradd -m -g root www-data

mkdir -p "${API_PATH}/logs" && chown -R www-data:root "${API_PATH}/logs"

systemctl daemon-reload
systemctl start ${APP_NAME}.service
systemctl status ${APP_NAME}.service
systemctl enable ${APP_NAME}.service
systemctl restart logrotate.service

# Проверка портов
netstat -tuln | grep ":${API_PORT_OUTSIDE}"
netstat -tuln | grep LISTEN
lsof -i :${API_PORT}"
lsof -i @router.zeleza.ru:${API_PORT_OUTSIDE}

Команды для отладки
--------------------------
logrotate -d  /apps/kvas/logs/${APP_NAME}.logrotate
pkill -f gunicorn
gunicorn -k gevent -w 1 --bind 0.0.0.0:61116 api:app
killall gevent
systemctl restart gevent.service
ps aux | grep api.py
ufw status numbered
ufw delete <num_port>


# Переход на другой домен 

1. У провайдера создай новый домен <new.domain.ru> и прикрепи его к рабочему сайту
2. Получи у провайдера SSL сертификаты 
3. Скопируй содержимое полученного сертификата CRT в файл /apps/kvas/cert/<new.domain.ru>.crt
4. Скопируй содержимое полученного сертификата KEY в файл /apps/kvas/cert/<new.domain.ru>.key
5. Поменяй в файлах проекта все упоминания старого доменного имени на новое
6. Перезапусти сервер на timeweb.cloud командой kvs_rb
7. В случае проблем используй команду kvs_py для зауска сервера в режиме отладки
